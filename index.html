<!DOCTYPE html>
<html>
<head>
    <title>文本分词可视化</title>
    <style>
        .container {
            display: flex;
            gap: 20px;
            padding: 20px;
        }
        
        .input-section, .output-section {
            flex: 1;
        }
        
        textarea {
            width: 100%;
            height: 300px;
        }
        
        .token {
            display: inline;
            padding: 2px 4px;
            margin: 0;
            border-radius: 3px;
        }
        
        .controls {
            margin: 10px 0;
        }
        
        .output-section {
            flex: 1;
            white-space: pre-wrap;
            word-break: break-word;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="input-section">
            <h3>输入文本</h3>
            <div class="controls">
                <select id="pattern-select" onchange="tokenize()">
                    <option value="gpt2">GPT2</option>
                    <option value="gpt4">GPT4</option>
                </select>
            </div>
            <textarea id="input-text" oninput="tokenize()"></textarea>
        </div>
        <div class="output-section">
            <h3>分词结果</h3>
            <div id="output"></div>
        </div>
    </div>
    <script>
        const patterns = {
            gpt2: "'(?:[sdmt]|ll|ve|re)| ?\\p{L}+| ?\\p{N}+| ?[^\\s\\p{L}\\p{N}]+|\\s+(?!\\S)|\\s+",
            gpt4: "'(?i:[sdmt]|ll|ve|re)|[^\\r\\n\\p{L}\\p{N}]?\\p{L}+|\\p{N}{1,3}| ?[^\\s\\p{L}\\p{N}]+[\\r\\n]*|\\s*[\\r\\n]|\\s+(?!\\S)|\\s+"
        };

        function getRandomColor() {
            const hue = Math.random() * 360;
            return `hsl(${hue}, 70%, 85%)`;
        }

        function tokenize() {
            try {
                const input = document.getElementById('input-text').value;
                const patternType = document.getElementById('pattern-select').value;
                const pattern = new RegExp(patterns[patternType], 'gu');
                
                const output = document.getElementById('output');
                output.innerHTML = '';
                
                let lastIndex = 0;
                const matches = Array.from(input.matchAll(pattern));
                
                matches.forEach(match => {
                    if (match.index > lastIndex) {
                        const textNode = document.createTextNode(input.slice(lastIndex, match.index));
                        output.appendChild(textNode);
                    }
                    
                    const span = document.createElement('span');
                    span.textContent = match[0];
                    span.className = 'token';
                    span.style.backgroundColor = getRandomColor();
                    output.appendChild(span);
                    
                    lastIndex = match.index + match[0].length;
                });
                
                if (lastIndex < input.length) {
                    const textNode = document.createTextNode(input.slice(lastIndex));
                    output.appendChild(textNode);
                }
            } catch (error) {
                console.error('分词错误:', error);
                document.getElementById('output').innerHTML = `<span style="color: red;">分词出错: ${error.message}</span>`;
            }
        }

    </script>
</body>
</html> 